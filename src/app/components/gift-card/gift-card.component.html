<p-card 
  [style]="{'height': '100%', 'display': 'flex', 'flex-direction': 'column'}"
  [styleClass]="'h-full flex flex-col shadow-lg hover:shadow-xl transition-shadow duration-300 ' + (isUnavailable() ? 'opacity-50 pointer-events-none' : '')">
  <ng-template pTemplate="header">
    <div class="relative">
      <img 
        [src]="gift.imageUrl" 
        [alt]="gift.name"
        class="w-full h-48 sm:h-56 md:h-64 object-cover"
        (error)="onImageError($event)"
        loading="lazy" />
      <p-tag 
        *ngIf="gift.isPurchased" 
        value="Comprado" 
        severity="success"
        styleClass="absolute top-2 right-2">
      </p-tag>
      <p-tag 
        *ngIf="isUnavailable()" 
        value="Indisponível" 
        severity="danger"
        styleClass="absolute top-2 left-2">
      </p-tag>
    </div>
  </ng-template>
  
  <div class="flex flex-col flex-grow">
    <h3 class="text-xl font-bold text-white mb-2">
      {{ gift.name }}
      <span *ngIf="gift.isIllustrativeImage" class="text-yellow-400 text-sm ml-1" title="Foto meramente ilustrativa">*</span>
    </h3>
    <p class="text-gray-300 text-sm mb-3 flex-grow">
      {{ gift.description || 'Sem descrição disponível.' }}
      <span *ngIf="gift.isIllustrativeImage" class="text-yellow-400 text-xs ml-1">* Foto meramente ilustrativa</span>
    </p>
    
    <div *ngIf="gift.averagePrice" class="mb-3">
      <p class="text-base font-semibold text-indigo-400">
        <i class="pi pi-money-bill mr-1"></i>
        {{ gift.averagePrice | currencyBr }}
      </p>
    </div>

    <div *ngIf="gift.linkUrl" class="mb-3">
      <a 
        [href]="gift.linkUrl" 
        target="_blank" 
        rel="noopener noreferrer"
        class="inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors text-sm font-medium">
        <i class="pi pi-external-link"></i>
        <span>Acessar o Link</span>
      </a>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <!-- Admin Actions -->
    <div *ngIf="currentUser && userService.isAdmin()" class="flex gap-3">
      <p-button 
        label="Editar" 
        icon="pi pi-pencil" 
        (onClick)="onEdit()"
        styleClass="flex-1 p-button-outlined">
      </p-button>
      <p-button 
        label="Deletar" 
        icon="pi pi-trash" 
        (onClick)="onDelete()"
        styleClass="flex-1 p-button-danger">
      </p-button>
    </div>

    <!-- Simple User Actions -->
    <div *ngIf="currentUser && !userService.isAdmin()">
      <div *ngIf="isUnavailable()" class="space-y-3">
        <p-button 
          label="Indisponível" 
          icon="pi pi-ban" 
          styleClass="w-full p-button-danger"
          [disabled]="true">
        </p-button>
        <p class="text-xs text-gray-400 text-center">
          Este item foi comprado por outra pessoa.
        </p>
      </div>
      <div *ngIf="!isUnavailable()">
        <p-button 
          *ngIf="!gift.isPurchased && !isInCart()"
          label="Adicionar ao Carrinho" 
          icon="pi pi-shopping-cart" 
          (onClick)="onPurchase()"
          [loading]="isAddingToCart()"
          [disabled]="isAddingToCart()"
          styleClass="w-full p-button-primary">
        </p-button>
        <p-button 
          *ngIf="!gift.isPurchased && isInCart()"
          label="No Carrinho" 
          icon="pi pi-check" 
          styleClass="w-full p-button-success"
          [disabled]="true">
        </p-button>
        <div *ngIf="gift.isPurchased" class="space-y-3">
          <p-button 
            label="Já Comprado" 
            icon="pi pi-check-circle" 
            styleClass="w-full p-button-success"
            [disabled]="true">
          </p-button>
          <p-button 
            *ngIf="canUnpurchase()"
            label="Remover Marcação" 
            icon="pi pi-times" 
            (onClick)="onUnpurchase()"
            [loading]="isUnpurchasing()"
            [disabled]="isUnpurchasing()"
            styleClass="w-full p-button-outlined">
          </p-button>
        </div>
      </div>
    </div>
  </ng-template>
</p-card>

